<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMAGE-to-Video Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .loading { display: none; }
        .nav-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }
        .content-container {
            margin-top: 80px; /* 根據導航欄高度調整，避免內容被遮擋 */
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col">
    <!-- 導航欄：固定在頂部 -->
    <nav class="bg-gray-800 py-4 nav-fixed">
        <div class="container mx-auto flex justify-center space-x-8">
        <a href="/minimax_Router/minimax_Get" class="text-yellow-400 hover:text-yellow-100">GET</a>
        <a href="/minimax_Router/minimax_Image" class="text-yellow-400 hover:text-yellow-100">IMAGE</a>
        <a href="/minimax_Router/minimax_Subject-Reference" class="text-yellow-400 hover:text-yellow-100">SUBJECT_REFERENCE</a>
        <a href="/minimax_Router/minimax_Text" class="text-yellow-400 hover:text-yellow-100">TEXT</a>
      <a href="/minimax_Router/minimax_UploadImage" class="text-yellow-400 hover:text-yellow-100">上傳圖片</a>
      <a href="/minimax_Router/minimax_UploadImage/list" class="text-yellow-400 hover:text-yellow-100">圖片列表</a>
        </div>
    </nav>
    <div class="content-container flex-grow flex items-center justify-center px-4">
    <div class="bg-gray-800 rounded-lg shadow-lg p-8 max-w-md w-full">
        <h1 class="text-white text-3xl font-bold mb-6 text-center">Generate videos from <br><span class="text-yellow-400">IMAGE</span></h1>
        
        <textarea id="prompt" rows="8" class="w-full p-2 rounded-md border border-gray-600 bg-gray-700 text-white placeholder-gray-500" placeholder="Please enter wording... Text description of the video, up to 2000 characters."></textarea>
        
        <textarea id="image_url" rows="4" class="my-4 w-full p-2 rounded-md border border-gray-600 bg-gray-700 text-white placeholder-gray-500" placeholder="https://cdn.hailuoai.com/prod/2024-09-18-16/user/multi_chat_file/9c0b5c14-ee88-4a5b-b503-4f626f018639.jpeg"></textarea>
        
        <div class="mb-4">
            <span class="text-white text-xl font-semibold pr-3">Video Model:</span>
            <select id="model" class="p-2 rounded bg-gray-700 text-white border border-gray-600">
                <option value="MiniMax-Hailuo-2.3-Fast">MiniMax-Hailuo-2.3-Fast</option>
                <option value="MiniMax-Hailuo-2.3">MiniMax-Hailuo-2.3</option>
                <option value="MiniMax-Hailuo-02">MiniMax-Hailuo-02</option>
                <option value="I2V-01-Director">I2V-01-Director</option>
                <option value="I2V-01-live">I2V-01-live</option>
                <option value="I2V-01">I2V-01</option>
            </select>
        </div>
        
        <div class="mb-4">
            <span class="text-white text-xl font-semibold pr-3">Video Resolution:</span>
            <select id="resolution" class="p-2 rounded bg-gray-700 text-white border border-gray-600">
                <option value="1080P">1080P</option>
                <option value="768P">768P</option>
                <option value="720P">720P (I2V only)</option>
            </select>
        </div>
        
        <button id="generate-btn" class="mt-8 mb-4 w-full bg-gray-500 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-md transition duration-200">Generate</button>
        
        <div class="flex justify-center" style="width:30%">
            <img id="loader" src="./spinner-8565_512.gif" width="100%" height="100%" alt="Loading...">
        </div>
        
        <p id="status" class="my-4 text-gray-300"></p>
        <p class="my-4 text-gray-300">Task ID: <span id="task-id"></span></p>
        <p class="my-4 mb-5 text-gray-300">Video URL Link: <span id="download-url"></span></p>
        <a id="download-btn" href="#" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-200 hidden inline-block">Download Video</a>
    </div>
</div>
    <script>
        const apiKey = '<%= apiKey %>';

        document.getElementById('generate-btn').addEventListener('click', async () => {
            const prompt = document.getElementById('prompt').value.trim();
            const image_url = document.getElementById('image_url').value.trim();
            const model = document.getElementById('model').value;
            const resolution = document.getElementById('resolution').value;
            const statusElement = document.getElementById('status');
            const taskIdElement = document.getElementById('task-id');
            const loaderElement = document.getElementById('loader');

            if (!prompt || !image_url) return alert('Please fill in all fields.');

            loaderElement.style.display = 'block';
            statusElement.textContent = 'Submitting request...';

            try {
                const createResponse = await fetch('https://api.minimax.io/v1/video_generation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model, prompt, first_frame_image: image_url, duration: 6, resolution
                    })
                });

                const createData = await createResponse.json();
                
                if (createData.base_resp.status_code === 0) {
                    const taskId = createData.task_id;
                    statusElement.textContent = 'Video being generated. Please wait.';
                    taskIdElement.textContent = taskId;
                    checkStatus(taskId);
                } else {
                    statusElement.textContent = 'Error: ' + createData.base_resp.status_msg;
                }
            } catch (error) {
                statusElement.textContent = 'Error: ' + error.message;
            }
        });

        async function checkStatus(taskId) {
            const statusElement = document.getElementById('status');
            const interval = setInterval(async () => {
                try {
                    const statusResponse = await fetch(`https://api.minimax.io/v1/query/video_generation?task_id=${taskId}`, {
                        headers: { 'Authorization': `Bearer ${apiKey}` }
                    });
                    const statusData = await statusResponse.json();

                    if (statusData.base_resp.status_code === 0) {
                        if (statusData.status === 'Success') {
                            clearInterval(interval);
                            statusElement.textContent = 'The video has been generated.';
                            await getDownloadLink(statusData.file_id);
                        } else {
                            statusElement.textContent = 'Video Status: ' + statusData.status;
                        }
                    } else {
                        clearInterval(interval);
                        statusElement.textContent = 'Error: ' + statusData.base_resp.status_msg;
                    }
                } catch (error) {
                    clearInterval(interval);
                    statusElement.textContent = 'Polling error: ' + error.message;
                }
            }, 5000);
        }

        async function getDownloadLink(fileId) {
            const downloadElement = document.getElementById('download-btn');
            const downloadUrlElement = document.getElementById('download-url');
            const loaderElement = document.getElementById('loader');
            
            try {
                const downloadResponse = await fetch(`https://api.minimax.io/v1/files/retrieve?file_id=${fileId}`, {
                    headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' }
                });
                const downloadData = await downloadResponse.json();
                loaderElement.style.display = 'none';

                if (downloadData.base_resp.status_code === 0) {
                    const downloadUrl = downloadData.file.download_url;
                    downloadElement.href = downloadUrl;
                    downloadElement.classList.remove('hidden');
                    downloadUrlElement.textContent = downloadUrl;
                }
            } catch (error) {
                console.error('Download error:', error);
                loaderElement.style.display = 'none';
            }
        }
    </script>
</body>
</html>